<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC 	"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="main.mybatis">
	<cache />
	<select id="getfeed" resultType="feed" parameterType="hashmap">
		select
		feed_id,id,like_num,reg_date,recipe_name,
		(select nvl(count(*),0) from
		likely_bookmark l
		where l.feed_id=f.feed_id and l.type='LIKE' and
		l.id=#{id})
		likestate,
		(select nvl(count(*),0)from likely_bookmark l
		where l.feed_id=f.feed_id and l.type='BOOKMARK'and l.id=#{id})
		bookmarkstate
		from feed f where f.feed_id=#{feed_id}
		order by reg_date
		desc
	</select>
	<select id="getfeednol" parameterType="int" resultType="feed">
		select *
		from
		feed where feed_id=#{feed_id} order
		by
		reg_date desc
	</select>
	<!-- <select id="getfeeds" resultType="feed"> select * from feed order by 
		reg_date desc </select> -->
	<select id="getImg_name" parameterType="int" resultType="String">
		select
		image_name from img where feed_id=#{feed_id} order by img_id
	</select>
	<select id="getContent" parameterType="int" resultType="String">
		select
		content from img where feed_id=#{feed_id} order by img_id
	</select>

	<select id="getLikeList" parameterType="String" resultType="likely_bookmark">
		select * from likely_bookmark where id=#{id}
	</select>

	<select id="getfeeds" resultType="feed" parameterType="String">
		select
		feed_id,id,like_num,reg_date,recipe_name,
		(select nvl(count(*),0) from
		likely_bookmark l
		where l.feed_id=f.feed_id and l.type='LIKE' and
		l.id=#{id})
		likestate,
		(select nvl(count(*),0)from likely_bookmark l
		where l.feed_id=f.feed_id and l.type='BOOKMARK'and l.id=#{id})
		bookmarkstate
		from feed f
		order by reg_date desc
	</select>


	<insert id="like" parameterType="hashmap">
		INSERT INTO likely_bookmark
		(likely_bookmark_id, id,feed_id, type)
		VALUES(((select
		nvl(max(likely_bookmark_id),0) from
		likely_bookmark)+1),#{id},#{feed_id},#{type})
	</insert>

	<delete id="unlike" parameterType="hashmap">
		delete from likely_bookmark
		where id=#{id} and feed_id=#{feed_id} and
		type=#{type}
	</delete>

	<select id="getfeedsNologin" resultType="feed">
		select * from
		feed order
		by
		reg_date desc
	</select>
	<select id="getUserSearchList" parameterType="hashmap"
		resultType="R_member">
		select * from r_member where id like
		'%${autocompleteText}%'
	</select>

	<select id="getFeedSearchList" parameterType="hashmap"
		resultType="feed">
		select f.feed_id, f.id, f.like_num,f.reg_date,
		f.recipe_name from feed f, hash_feed hf
		where f.feed_id = hf.feed_id
		and hf.hashtag_id = (select hashtag_id from hashtag where
		hashtag_content
		= #{autocompleteText}) order by f.reg_date desc
	</select>

	<select id="getFoodSearchList" parameterType="hashmap"
		resultType="food">
		select * from food where name like '%${autocompleteText2}%'
	</select>

	<select id="getUserSearchListWithFollow" parameterType="hashmap"
		resultType="R_member">
		select id, profileImg, info,
		(select count(*) from r_member
		r, follow f where r.id = #{id} and other_id =
		rm.id) follow_status
		from
		r_member rm where id like '%${autocompleteText}%'
	</select>

	<select id="feedreple" parameterType="hashmap" resultType="reple">
		select * from reple where feed_id=#{feed_id} order by reple_id desc
	</select>

	<select id="getTodayRecomendFeed" resultType="feed">
	<![CDATA[
		select * from
		(select * from feed where to_char( trunc(reg_date), 'YYYYMMDD' ) =
		to_char( trunc(sysdate-1), 'YYYYMMDD' ) order by like_num desc) where
		rownum <= 3
	]]>
	</select>

	<select id="getHashtagCnt" resultType="hashtag">
		select (select
		hashtag_content from hashtag h where h.hashtag_id = hf.hashtag_id)
		hashtag_content ,
		count(*) cnt from hash_feed hf where hf.feed_id in
		(select f.feed_id from
		r_member r, feed f where r.id = f.id and r.sex =
		'F') group by
		hashtag_id order by cnt desc
	</select>

	<select id="getHashtagCnt2" resultType="hashtag">
		select (select
		hashtag_content from hashtag h where h.hashtag_id = hf.hashtag_id)
		hashtag_content ,
		count(*) cnt from hash_feed hf where hf.feed_id in
		(select f.feed_id from
		r_member r, feed f where r.id = f.id and r.sex =
		'M') group by
		hashtag_id order by cnt desc
	</select>
	<select id="getEditorFeed" resultType="feed">
		select f.feed_id, f.id,
		f.like_num, f.reg_date, f.recipe_name,r.grade feed_grade from feed f,
		r_member r
		where f.id = r.id and r.grade = 'editor' order by f.reg_date
		desc
	</select>

	<select id="editorfood" parameterType="hashmap" resultType="String">
		select (select q.name from food q where q.food_id=t.food_id) food_id
		from feed_food t where t.feed_id=#{feed_id}
	</select>


	<select id="selectUserIdDb" resultType="String">
		select id from r_member
	</select>

	<select id="selectHashDb" resultType="String">
		select hashtag_content from
		hashtag
	</select>

	<select id="selectFoodNameDb" resultType="String">
		select name from food
	</select>

	<select id="getHashtagKeyCount" parameterType="hashmap"
		resultType="int">
		select count(*) cnt from hash_feed hf, hashtag h where
		hf.hashtag_id = h.hashtag_id and h.hashtag_content = #{please} group by
		h.hashtag_id
	</select>
</mapper>