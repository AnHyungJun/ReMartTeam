<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC 	"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mypage.mybatis">
	<cache />
	<select id="pagea" parameterType="hashmap" resultType="R_member">
	select id,name,phone,grade,point,use_like,sex,profileimg,(select count(*) from feed e where e.id=#{id}) writenum, 
	(select count(*) from follow z where z.my_id=#{id}) follownum 
 	from r_member where id=#{id}
	</select>
	
	
	<select id="getfeedlist" parameterType="hashmap" resultType="feed">
		select feed_id,id,like_num,reg_date,recipe_name from feed where id=#{id} order by reg_date desc
	</select>
	<select id="getImg_name" parameterType="hashmap" resultType="String">
		select image_name from img where feed_id=#{feed_id} order by img_id 
	</select>
	<select id="getContent" parameterType="hashmap" resultType="String">
		select content from img where feed_id=#{feed_id} order by img_id 
	</select>
	<select id="feedreple" parameterType="hashmap" resultType="reple">
		select * from reple where feed_id=#{feed_id} order by reple_id desc
	</select>
	<select id="getMemberInfo" parameterType="hashmap" resultType="R_member">
		select passwd, name, phone, sex, zip1, zip2, address1, address2, jumin1, email, info from r_member where id=#{id} 
	</select>
	
	<update id="updateMember" parameterType="hashmap">
		update r_member set id=#{member.id}, passwd=#{member.passwd}, name=#{member.name}, phone=#{member.phone}, address1=#{member.address1},
		address2=#{member.address2}, zip1=#{member.zip1}, zip2=#{member.zip2}, sex=#{member.sex}, jumin1=#{member.jumin1},
		email=#{member.email}, info=#{member.info}, profileImg=#{member.profileImg} where id=#{member.id}
	
	</update>
	
	<select id="getLikeFeedList" parameterType="hashmap" resultType="feed">
		select * from feed f where f.feed_id in (select feed_id from likely_bookmark where id = #{id} and type='l') order by reg_date desc
	</select>
	
	<select id="getBookmarkFeedList" parameterType="hashmap" resultType="feed">
		select * from feed f where f.feed_id in (select feed_id from likely_bookmark where id = #{id} and type='b') order by reg_date desc
	</select>
	
	<select id="getFollowFeedList" parameterType="hashmap" resultType="feed">
		select * from feed f where id in (select id from r_member where id in (select other_id from follow where my_id=#{id})) order by reg_date desc
	</select>
	
	<select id="getFollowingList" parameterType="hashmap" resultType="r_member">
		select id,profileImg,info,1 follow_status from follow f,r_member r where my_id=#{id} and f.other_id = r.id
	</select>
	
</mapper>